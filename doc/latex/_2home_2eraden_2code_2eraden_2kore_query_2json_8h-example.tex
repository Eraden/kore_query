\hypertarget{_2home_2eraden_2code_2eraden_2kore_query_2json_8h-example}{}\section{/home/eraden/code/eraden/kore\+\_\+query/json.\+h}

\begin{DoxyCode}
\hyperlink{structsJSON}{JSON} *root = \hyperlink{json_8h_ad8fd00eaccc81958c5a65f805e5c00ba}{JSON\_alloc}(JSON\_OBJECT);
\hyperlink{structsJSON}{JSON} *array = \hyperlink{json_8h_ad8fd00eaccc81958c5a65f805e5c00ba}{JSON\_alloc}(JSON\_ARRAY);
\hyperlink{json_8h_a0b79fc03b1dffbc61cbbe9b817ef8ae6}{JSON\_set}(root, L\textcolor{stringliteral}{"users"}, array);

\textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 2; i++) \{
  \hyperlink{structsJSON}{JSON} *child = \hyperlink{json_8h_ad8fd00eaccc81958c5a65f805e5c00ba}{JSON\_alloc}(JSON\_OBJECT);
  \hyperlink{json_8h_ae9460db2cd54a7462fca0aab59aaea12}{JSON\_append}(array, child);
\}

JSON\_EACH\_PAIR(root, rootKey, rootChild)
    if (strcmp(rootKey, "some-key") == 0) ...;
    JSON\_EACH\_PAIR\_NEXT
JSON\_END\_EACH

JSON\_EACH(array, arrayIndex, arrayEntry)
    if (arrayIndex != 0) kore\_log(LOG\_INFO, ", ");
    JSON\_EACH\_NEXT
JSON\_END\_EACH

\hyperlink{structsJSONPath}{JSONPath} path[3] = \{
    \{ .type=JSON\_STRING, .name=\textcolor{stringliteral}{"users"} \},
    \{ .type=JSON\_NUMBER, .index=1 \},
    \{ .type=JSON\_UNDEFINED, .name=NULL \},
\};
\hyperlink{structsJSON}{JSON} *child = \hyperlink{json_8h_a6ea42f7260d5909a1287aca8676a7f3c}{JSON\_find}(source, path);

\textcolor{keywordtype}{char} *json = \hyperlink{json_8h_a88f3755b96cc3a6ca0adbd35e0092280}{JSON\_stringify}(root); \textcolor{comment}{//=> \{"users":[\{\},\{\}]\}}
\hyperlink{json_8h_ac5db034af6e012802315e2e5587a54df}{JSON\_free}(root);
free(json);
\end{DoxyCode}



\begin{DoxyCodeInclude}

\textcolor{preprocessor}{#pragma once}

\textcolor{preprocessor}{#include <string.h>}
\textcolor{preprocessor}{#include <stdio.h>}
\textcolor{preprocessor}{#include <stdlib.h>}

\textcolor{preprocessor}{#include "strings.h"}

\textcolor{keyword}{typedef} \textcolor{keyword}{struct }\hyperlink{structsJSON}{sJSON} \hyperlink{structsJSON}{JSON};
\textcolor{keyword}{typedef} \textcolor{keyword}{struct }\hyperlink{structsJSONPath}{sJSONPath} \hyperlink{structsJSONPath}{JSONPath};
\textcolor{keyword}{typedef} \textcolor{keyword}{enum} \hyperlink{json_8h_acab6725e93cbfcfcf4273259977127a1}{eJSONType} \hyperlink{json_8h_af761d54284482a1af5a01d8f52845b49}{JSONType};
\textcolor{keyword}{typedef} \textcolor{keyword}{union }\hyperlink{unioneJSONValue}{eJSONValue} \hyperlink{unioneJSONValue}{JSONValue};

\textcolor{preprocessor}{#define JSON\_EACH\_PAIR(expr, ENTRY\_KEY, ENTRY\_NAME) \{ \(\backslash\)}
\textcolor{preprocessor}{  JSON *object = expr; \(\backslash\)}
\textcolor{preprocessor}{  if (object) \{ \(\backslash\)}
\textcolor{preprocessor}{    JSON **childrenPtr = object->children.objects; \(\backslash\)}
\textcolor{preprocessor}{    char **keysPtr = object->children.keys; \(\backslash\)}
\textcolor{preprocessor}{    for (unsigned int childIndex = 0; childIndex < object->children.len; childIndex ++) \{ \(\backslash\)}
\textcolor{preprocessor}{      JSON *ENTRY\_NAME = *childrenPtr; \(\backslash\)}
\textcolor{preprocessor}{      char *ENTRY\_KEY = *keysPtr; \(\backslash\)}
\textcolor{preprocessor}{}
\textcolor{preprocessor}{#define JSON\_EACH\_PAIR\_NEXT \(\backslash\)}
\textcolor{preprocessor}{      childrenPtr += 1; \(\backslash\)}
\textcolor{preprocessor}{      keysPtr += 1;}

\textcolor{preprocessor}{#define JSON\_EACH(expr, ENTRY\_INDEX, ENTRY\_NAME) \{ \(\backslash\)}
\textcolor{preprocessor}{  JSON *array = expr; \(\backslash\)}
\textcolor{preprocessor}{  if (array) \{ \(\backslash\)}
\textcolor{preprocessor}{    JSON **childrenPtr = array->array.objects; \(\backslash\)}
\textcolor{preprocessor}{    for (unsigned int ENTRY\_INDEX = 0; ENTRY\_INDEX < array->array.len; ENTRY\_INDEX ++) \{ \(\backslash\)}
\textcolor{preprocessor}{      JSON *ENTRY\_NAME = *childrenPtr;}

\textcolor{preprocessor}{#define JSON\_EACH\_NEXT childrenPtr += 1;}

\textcolor{preprocessor}{#define JSON\_END\_EACH \} \} \}}

\textcolor{preprocessor}{#define JSON\_AS\_NUMBER(obj) obj->jsonValue.value}
\textcolor{preprocessor}{#define JSON\_AS\_STRING(obj) obj->jsonValue.string}

\textcolor{keyword}{typedef} \textcolor{keyword}{union }\hyperlink{unioneJSONValue}{eJSONValue} \{
  \textcolor{keywordtype}{char} *string;
  \textcolor{keywordtype}{float} value;
\} \hyperlink{json_8h_acb7eaa79e9cdd0740c01726c3ba06e3e}{JSONValue};

\textcolor{keyword}{typedef} \textcolor{keyword}{enum} \hyperlink{json_8h_acab6725e93cbfcfcf4273259977127a1}{eJSONType} \{
  JSON\_UNDEFINED = 0,
  JSON\_STRING = 1,
  JSON\_NUMBER = 1 << 1,
  JSON\_OBJECT = 1 << 2,
  JSON\_ARRAY = 1 << 3,
  JSON\_NULL = 1 << 4,
\} \hyperlink{json_8h_af761d54284482a1af5a01d8f52845b49}{JSONType};

\textcolor{keyword}{typedef} \textcolor{keyword}{enum} \hyperlink{json_8h_a7a8b3184f1ecbd8fcfdb66bd9514d2b3}{eJSONCloneType} \{
  JSON\_SIMPLE = 0,
  JSON\_DEEP = 1
\} \hyperlink{json_8h_a82504dc7a921c3161c7fd45d4215e7b0}{JSONCloneType};

\textcolor{keyword}{typedef} \textcolor{keyword}{struct }\hyperlink{structsJSON}{sJSON} \{
  JSONType type; 
  \hyperlink{unioneJSONValue}{JSONValue} jsonValue; 
  \textcolor{keyword}{struct }\{
    \hyperlink{structsJSON}{JSON} **objects; 
    \textcolor{keywordtype}{char} **keys; 
    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} len; 
  \} children; 
  \textcolor{keyword}{struct }\{
    \hyperlink{structsJSON}{JSON} **objects; 
    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} len; 
  \} array; 
\} \hyperlink{json_8h_a883822215fcdb974b95ff5339b5ecab4}{JSON};

\textcolor{keyword}{typedef} \textcolor{keyword}{struct }\hyperlink{structsJSONPath}{sJSONPath} \{
  \textcolor{keyword}{union }\{
    \textcolor{keywordtype}{char} *name;
    \textcolor{keywordtype}{unsigned} index;
  \};
  JSONType type;
\} \hyperlink{json_8h_a0f3747cfbfe6c68ae7b67184bd731728}{JSONPath};

\hyperlink{structsJSON}{JSON} *\hyperlink{json_8h_ad8fd00eaccc81958c5a65f805e5c00ba}{JSON\_alloc}(JSONType type);

\hyperlink{structsJSON}{JSON} *\hyperlink{json_8h_a8564e11a595dfb8e42182c28147b1d70}{JSON\_string}(\textcolor{keywordtype}{char} *str);

\hyperlink{structsJSON}{JSON} *\hyperlink{json_8h_abcecc56303be7d8c3b1e835d058d5a2d}{JSON\_number}(\textcolor{keywordtype}{float} n);

\textcolor{keywordtype}{void} \hyperlink{json_8h_ac5db034af6e012802315e2e5587a54df}{JSON\_free}(\hyperlink{structsJSON}{JSON} *\textcolor{keywordtype}{object});

\hyperlink{structsJSON}{JSON} *\hyperlink{json_8h_a0b79fc03b1dffbc61cbbe9b817ef8ae6}{JSON\_set}(\hyperlink{structsJSON}{JSON} *parent, \textcolor{keywordtype}{wchar\_t} *key, \hyperlink{structsJSON}{JSON} *json);

\hyperlink{structsJSON}{JSON} *\hyperlink{json_8h_ae9460db2cd54a7462fca0aab59aaea12}{JSON\_append}(\hyperlink{structsJSON}{JSON} *array, \hyperlink{structsJSON}{JSON} *entry);

\textcolor{keywordtype}{char} *\hyperlink{json_8h_a88f3755b96cc3a6ca0adbd35e0092280}{JSON\_stringify}(\hyperlink{structsJSON}{JSON} *root);

\hyperlink{structsJSON}{JSON} *\hyperlink{json_8h_a6ea42f7260d5909a1287aca8676a7f3c}{JSON\_find}(\hyperlink{structsJSON}{JSON} *source, \hyperlink{structsJSONPath}{JSONPath} *path);

\textcolor{keywordtype}{char} *\hyperlink{json_8h_ac6e8a1f93227d3017c1e3b5e1bb03591}{JSON\_escape}(\textcolor{keywordtype}{char} *\textcolor{keywordtype}{string});

\hyperlink{structsJSON}{JSON} *\hyperlink{json_8h_a5d72929696e1de3ab3b8ad39a684dded}{JSON\_clone}(\hyperlink{structsJSON}{JSON} *obj, \hyperlink{json_8h_a82504dc7a921c3161c7fd45d4215e7b0}{JSONCloneType} deep);

\textcolor{keywordtype}{int} \hyperlink{json_8h_ad042d2d456ea6186716a5071c0151370}{JSON\_mergeJSON}(\hyperlink{structsJSON}{JSON} *target, \hyperlink{structsJSON}{JSON} *source, 
      \hyperlink{json_8h_a82504dc7a921c3161c7fd45d4215e7b0}{JSONCloneType} deep);

\hyperlink{unioneJSONValue}{JSONValue} \hyperlink{json_8h_af6b5d6ad33f7765b65e275785b40ef8b}{JSON\_valueOf}(\hyperlink{structsJSON}{JSON} *\textcolor{keywordtype}{object}, \textcolor{keywordtype}{char} *key);
\end{DoxyCodeInclude}
 